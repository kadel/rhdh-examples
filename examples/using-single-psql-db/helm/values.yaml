global:
  dynamic:
    includes:
      - dynamic-plugins.default.yaml

    plugins:

      - package: oci://quay.io/tkral/entity-feedback-plugin:0.6.0!backstage-community-plugin-entity-feedback
        disabled: false
        pluginConfig:
          dynamicPlugins:
            frontend:
              backstage-community.plugin-entity-feedback:
                entityTabs:
                  - mountPoint: entity.page.feedback
                    path: /feedback
                    title: Feedback
                mountPoints:
                  - config:
                      layout:
                        gridColumn: 1 / -1
                    importName: StarredRatingButtons
                    mountPoint: entity.page.feedback/cards
                  - config:
                      layout:
                        gridColumn: 1 / -1
                    importName: EntityFeedbackResponseContent
                    mountPoint: entity.page.feedback/cards
                  - config:
                      layout:
                        gridColumnEnd:
                          lg: span 6
                          md: span 6
                          xs: span 6
                    importName: StarredRatingButtons
                    mountPoint: entity.page.overview/cards

      - package: oci://quay.io/tkral/entity-feedback-plugin-backend:0.7.1!backstage-community-plugin-entity-feedback-backend
        disabled: false
        # - package: oci://quay.io/tkral/plugin-infrawallet-frontend:v1.1.0!electrolux-oss-plugin-infrawallet
        #   disabled: false
        #   pluginConfig:
        #     backend:
        #       infraWallet:
        #         autoload:
        #           enabled: true
        #           schedule: '0 0 * * *' # midnight
        #           initialDelayMinutes: 1 # delay by 1 min

        # - package: oci://quay.io/tkral/plugin-infrawallet-backend:v1.1.0!electrolux-oss-plugin-infrawallet-backend
        #   disabled: false
        #   pluginConfig:
        #     infraWallet:
        #       settings: {}
        #     dynamicPlugins:
        #       frontend:
        #         electrolux-oss.plugin-infrawallet:
        #            appIcons:
        #             - name: InfraWalletIcon # unique icon name
        #               importName: InfraWalletIcon # optional, actual component name that should be rendered
        #            dynamicRoutes:
        #             - path: /infrawallet
        #               importName: InfraWalletPage
        #               menuItem:
        #                 icon: InfraWalletIcon
        #                 text: Infrawallet

        # - package: ./local-plugins/test-plugin
        #   disabled: false
        #   pluginConfig:
        #     dynamicPlugins:
        #       frontend:
        #         internal.plugin-test-plugin:
        #           dynamicRoutes:
        #             - path: /test-plugin
        #               importName: TestPluginPage
        #               menuItem:
        # text: Test Plugin

        # - disabled: false
        #   package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard:pr_1566__1.0.0!red-hat-developer-hub-backstage-plugin-scorecard
        #   pluginConfig:
        #     dynamicPlugins:
        #       frontend:
        #         red-hat-developer-hub.backstage-plugin-scorecard:
        #           entityTabs:
        #             - path: '/scorecard'
        #               title: Scorecard
        #               mountPoint: entity.page.scorecard
        #           mountPoints:
        #             - mountPoint: entity.page.scorecard/cards
        #               importName: EntityScorecardContent
        #               config:
        #                 layout:
        #                   gridColumn: 1 / -1
        # - disabled: false
        #   package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard-backend:pr_1566__1.0.0!red-hat-developer-hub-backstage-plugin-scorecard-backend
        # - disabled: false
        #   package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard-backend-module-github:pr_1526__0.2.0!red-hat-developer-hub-backstage-plugin-scorecard-backend-module-github
        #   pluginConfig:
        #     integrations:
        #       github:
        #         - host: github.com
        #           token: <token>

        # - disabled: false
        #   package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard-backend-module-jira:pr_1526__0.2.0!red-hat-developer-hub-backstage-plugin-scorecard-backend-module-jira
        #   pluginConfig:
        #     jira:
        #       baseUrl: https://issues.redhat.com
        #       token: <token>
        #       product: datacenter

        # # Backend plugin
        # - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/aws-amazon-ecs-plugin-for-backstage-backend:pr_1426__0.8.0!aws-amazon-ecs-plugin-for-backstage-backend
        #   disabled: false
        #   pluginConfig:
        #     # Backend plugin uses AWS SDK credential chain
        #     # Configure via environment variables:
        #     # AWS_REGION, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY

        # # Frontend plugin
        # - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/aws-amazon-ecs-plugin-for-backstage:pr_1426__0.6.0!aws-amazon-ecs-plugin-for-backstage
        #   disabled: false
        #   pluginConfig:
        #     dynamicPlugins:
        #       frontend:
        #         aws.amazon-ecs-plugin-for-backstage:
        #           entityTabs:
        #             - path: /amazon-ecs
        #               title: Amazon ECS
        #               mountPoint: entity.page.amazon-ecs
        #           mountPoints:
        #             - mountPoint: entity.page.amazon-ecs/cards
        #               importName: EntityAmazonEcsServicesContent
        #               config:
        #                 layout:
        #                   gridColumn: "1 / -1"
        #                 if:
        #                   anyOf:
        #                     - hasAnnotation: aws.amazon.com/amazon-ecs-service-tags
        #                     - hasAnnotation: aws.amazon.com/amazon-ecs-service-arn

upstream:
  backstage:
    # This is required in order to remove POSTGRESQL_ADMIN_PASSWORD from the environment variables
    #Â https://github.com/redhat-developer/rhdh-chart/blob/dba8d637567b430d6c0b95734b69198ac0b2eb4c/charts/backstage/values.yaml#L127-L137
    extraEnvVarsSecrets:
      - my-rhdh-secrets
    appConfig:
      app:
        title: My RHDH App

      auth:
        providers:
          guest:
            dangerouslyAllowOutsideDevelopment: true
      backend:
        database:
          client: pg
          pluginDivisionMode: schema
          ensureSchemaExists: true
          connection:
            database: ${POSTGRES_DATABASE}
            host: ${POSTGRES_HOST}
            port: ${POSTGRES_PORT}
            user: ${POSTGRES_USER}
            password: ${POSTGRES_PASSWORD}
    extraEnvVars:
      - name: BACKEND_SECRET
        valueFrom:
          secretKeyRef:
            key: backend-secret
            name: '{{ include "janus-idp.backend-secret-name" $ }}'
  postgresql:
    enabled: false
